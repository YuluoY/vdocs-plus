{"remainingRequest":"D:\\桌面\\vdocs-plus\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\桌面\\vdocs-plus\\src\\server\\Article\\ArticleWrite.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\桌面\\vdocs-plus\\src\\server\\Article\\ArticleWrite.vue","mtime":1660498062717},{"path":"D:\\桌面\\vdocs-plus\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1661267353134},{"path":"D:\\桌面\\vdocs-plus\\node_modules\\babel-loader\\lib\\index.js","mtime":1661267356503},{"path":"D:\\桌面\\vdocs-plus\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1661267353134},{"path":"D:\\桌面\\vdocs-plus\\node_modules\\vue-loader\\lib\\index.js","mtime":1661267357130}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgVnVlTWFya2Rvd25FZGl0b3IgZnJvbSAiQC9wbHVnaW5zL1Z1ZU1hcmtkb3duRWRpdG9yIjsKaW1wb3J0IEhVcGxvYWQgZnJvbSAiQC9zZXJ2ZXIvY29tcG9uZW50L2gtdXBsb2FkIjsKaW1wb3J0IHtpc0VtcHR5T2JqfSBmcm9tICJAL3V0aWxzIjsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJBcnRpY2xlV3JpdGUiLAogICAgY29tcG9uZW50czogewogICAgICAgIEhVcGxvYWQsCiAgICAgICAgVnVlTWFya2Rvd25FZGl0b3IKICAgIH0sCiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG1vZGVsOiB7CiAgICAgICAgICAgICAgICBjYXRlZ29yaWVzOiBbXSwKICAgICAgICAgICAgICAgIHZpZXdOdW06IDAsCiAgICAgICAgICAgICAgICBjb21tZW50TnVtOiAwLAogICAgICAgICAgICAgICAgaW1nVXJsOiAnJwogICAgICAgICAgICB9LAogICAgICAgICAgICBjYXRlZ29yaWVzOiBbXSwKICAgICAgICAgICAgc2VhcmNoOicnCiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBoYW5kbGVFZGl0KGluZGV4LCByb3cpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coaW5kZXgsIHJvdyk7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVEZWxldGUoaW5kZXgsIHJvdykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhpbmRleCwgcm93KTsKICAgICAgICB9LAogICAgICAgIHNldEltZ1VybCh1cmwpIHsKICAgICAgICAgICAgdGhpcy5tb2RlbC5pbWdVcmwgPSB1cmw7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVVcGxvYWRJbWFnZShldmVudCwgaW5zZXJ0SW1hZ2UsIGZpbGVzKSB7CgogICAgICAgIH0sCiAgICAgICAgaGFuZGxlU2F2ZSh0ZXh0LCBodG1sKSB7CiAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGVudCA9IHRleHQ7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBvblN1Ym1pdCgpIHsKICAgICAgICAgICAgbGV0IHJlcyA9IG51bGw7CiAgICAgICAgICAgIGxldCBvcGVyYXRpb24gPSAn5re75YqgJwogICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5jb250ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzRW1wdHlPYmoodGhpcy4kcm91dGUucXVlcnkpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzID0gYXdhaXQgdGhpcy4kYXBpcy5hZG1pbi51cGRhdGVBcnRpY2xlKHRoaXMubW9kZWwpOwogICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbiA9ICfmm7TmlrAnCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlcyA9IGF3YWl0IHRoaXMuJGFwaXMuYWRtaW4uYWRkQXJ0aWNsZSh0aGlzLm1vZGVsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoYOaWh+eroCIke3RoaXMubW9kZWwudGl0bGV9IiR7b3BlcmF0aW9ufeaIkOWKn++8gWApCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnB1c2goJ0FydGljbGVVcGRhdGUnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7fmkrDlhpnmlofnq6DlkI7mj5DkuqTvvIEnKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgdXBkYXRlQ2F0ZWdvcnkoKSB7CgogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZ2V0QWxsQ2F0ZWdvcnkoKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBhd2FpdCB0aGlzLiRhcGlzLmFkbWluLmdldEFsbENhdGVnb3J5KCdjYXRlZ29yaWVzJykKICAgICAgICAgICAgdGhpcy5jYXRlZ29yaWVzID0gYS5kYXRhOwogICAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMuZ2V0QWxsQ2F0ZWdvcnkoKTsKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICAgIGlmICghaXNFbXB0eU9iaih0aGlzLiRyb3V0ZS5xdWVyeSkpIHsKICAgICAgICAgICAgY29uc3QgYXJ0aWNsZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2gtYXJ0aWNsZS1lZGl0JykgfHwgJ3t9Jyk7CiAgICAgICAgICAgIHRoaXMubW9kZWwgPSB7Li4uYXJ0aWNsZX07CiAgICAgICAgICAgIHRoaXMubW9kZWwuY2F0ZWdvcmllcy5sZW5ndGggPSAwCiAgICAgICAgICAgIGFydGljbGUuY2F0ZXMuZm9yRWFjaChpdGVtID0+IHRoaXMubW9kZWwuY2F0ZWdvcmllcy5wdXNoKGl0ZW0uX2lkKSkKICAgICAgICB9CiAgICB9Cn0K"},{"version":3,"sources":["ArticleWrite.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ArticleWrite.vue","sourceRoot":"src/server/Article","sourcesContent":["<template>\r\n    <div class=\"articleWrite\">\r\n        <div>\r\n            <el-form>\r\n                <el-form-item label=\"标题：\" label-width=\"60px\">\r\n                    <el-input type=\"text\" placeholder=\"请输入标题\" v-model=\"model.title\" autofocus></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"作者：\" label-width=\"60px\">\r\n                    <el-input type=\"text\" placeholder=\"请输入作者\" v-model=\"model.author\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"类别：\" label-width=\"60px\">\r\n                    <el-select v-model=\"model.categories\" placeholder=\"请选择\" multiple style=\"width: 100%;\">\r\n                        <el-option\r\n                                v-for=\"(item,i) in categories\"\r\n                                :key=\"item._id + `-${i}`\"\r\n                                :label=\"item.cateName\"\r\n                                :value=\"item._id\">\r\n                        </el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"描述：\" label-width=\"60px\">\r\n                    <el-input type=\"textarea\" placeholder=\"请输入描述\" v-model=\"model.desc\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"上传图片：\" label-width=\"90px\">\r\n                    <h-upload :setImgUrl=\"setImgUrl\" :img-url=\"model.imgUrl\"></h-upload>\r\n                </el-form-item>\r\n                <el-form-item label=\"浏览数：\" label-width=\"90px\">\r\n                    <el-input-number v-model=\"model.viewNum\" :min=\"0\" label=\"描述文字\"></el-input-number>\r\n                </el-form-item>\r\n                <el-form-item label=\"评论列表：\">\r\n                    <el-table\r\n                            height=\"200\"\r\n                            :data=\"model.comments && model.comments.filter(data => !search || data.content.toLowerCase().includes(search.toLowerCase()))\"\r\n                            style=\"width: 100%\">\r\n                        <el-table-column label=\"_id\" prop=\"_id\"></el-table-column>\r\n                        <el-table-column label=\"头像\" prop=\"imgUrl\">\r\n                            <template slot-scope=\"scope\">\r\n                                <el-avatar :src=\"scope.row.imgUrl\" shape=\"square\"></el-avatar>\r\n                            </template>\r\n                        </el-table-column>\r\n                        <el-table-column label=\"姓名\" prop=\"name\"></el-table-column>\r\n                        <el-table-column label=\"评论内容\" prop=\"content\"></el-table-column>\r\n                        <el-table-column label=\"评论时间\" prop=\"createdAt\"></el-table-column>\r\n                        <el-table-column align=\"right\">\r\n                            <template slot=\"header\" slot-scope=\"scope\">\r\n                                <el-input v-model=\"search\" size=\"mini\" placeholder=\"输入关键字搜索\"/>\r\n                            </template>\r\n                            <template slot-scope=\"scope\">\r\n                                <el-button size=\"mini\"\r\n                                        @click=\"handleEdit(scope.$index, scope.row)\">Edit</el-button>\r\n                                <el-button\r\n                                        size=\"mini\"\r\n                                        type=\"danger\"\r\n                                        @click=\"handleDelete(scope.$index, scope.row)\">Delete</el-button>\r\n                            </template>\r\n                        </el-table-column>\r\n                    </el-table>\r\n                </el-form-item>\r\n            </el-form>\r\n            <vue-markdown-editor v-model=\"model.content\"\r\n                                 @save=\"handleSave\"\r\n                                 @upload-image=\"handleUploadImage\"\r\n                                 :include-level=\"[1,2,3]\"\r\n                                 height=\"400px\"></vue-markdown-editor>\r\n            <div style=\"text-align: center; margin-top: 2em;\">\r\n                <el-button type=\"primary\" plain style=\"width: 100%\" @click=\"onSubmit\">\r\n                    {{ JSON.stringify($route.query) === '{}' ? '添加' : '更新' }}文章\r\n                </el-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\n    import VueMarkdownEditor from \"@/plugins/VueMarkdownEditor\";\r\n    import HUpload from \"@/server/component/h-upload\";\r\n    import {isEmptyObj} from \"@/utils\";\r\n\r\n    export default {\r\n        name: \"ArticleWrite\",\r\n        components: {\r\n            HUpload,\r\n            VueMarkdownEditor\r\n        },\r\n        data() {\r\n            return {\r\n                model: {\r\n                    categories: [],\r\n                    viewNum: 0,\r\n                    commentNum: 0,\r\n                    imgUrl: ''\r\n                },\r\n                categories: [],\r\n                search:''\r\n            }\r\n        },\r\n        methods: {\r\n            handleEdit(index, row) {\r\n                console.log(index, row);\r\n            },\r\n            handleDelete(index, row) {\r\n                console.log(index, row);\r\n            },\r\n            setImgUrl(url) {\r\n                this.model.imgUrl = url;\r\n            },\r\n            handleUploadImage(event, insertImage, files) {\r\n\r\n            },\r\n            handleSave(text, html) {\r\n                this.model.content = text;\r\n            },\r\n            async onSubmit() {\r\n                let res = null;\r\n                let operation = '添加'\r\n                if (this.model.content) {\r\n                    if (!isEmptyObj(this.$route.query)) {\r\n                        res = await this.$apis.admin.updateArticle(this.model);\r\n                        operation = '更新'\r\n                    } else {\r\n                        res = await this.$apis.admin.addArticle(this.model);\r\n                    }\r\n                    if (res) {\r\n                        this.$message.success(`文章\"${this.model.title}\"${operation}成功！`)\r\n                        await this.$router.push('ArticleUpdate')\r\n                    }\r\n                } else {\r\n                    this.$message.warning('请撰写文章后提交！');\r\n                }\r\n            },\r\n            async updateCategory() {\r\n\r\n            },\r\n            async getAllCategory() {\r\n                const a = await this.$apis.admin.getAllCategory('categories')\r\n                this.categories = a.data;\r\n            }\r\n        },\r\n        created() {\r\n            this.getAllCategory();\r\n        },\r\n        mounted() {\r\n            if (!isEmptyObj(this.$route.query)) {\r\n                const article = JSON.parse(localStorage.getItem('h-article-edit') || '{}');\r\n                this.model = {...article};\r\n                this.model.categories.length = 0\r\n                article.cates.forEach(item => this.model.categories.push(item._id))\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n</style>"]}]}